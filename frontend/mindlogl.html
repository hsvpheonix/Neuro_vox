
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>NeuroVox Recovery Companion</title>
<style>
  :root{
    --bg:#0f1115; --card:#171923; --muted:#a3b3c2; --text:#e6eef6; --accent:#00e0ff; --accent-2:#7cffb2; --danger:#ff6b6b;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family: Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    background:linear-gradient(180deg,#0a0c10 0%, #0f1115 100%); color:var(--text);
  }
  header, footer{padding:16px 20px; background:#0a0c10; border-bottom:1px solid #1d2130}
  header h1{margin:0; font-weight:800; letter-spacing:0.3px}
  header p{margin:6px 0 0; color:var(--muted)}
  main{padding:20px; display:grid; gap:20px; grid-template-columns: 1.3fr 1fr}
  @media (max-width: 1024px){ main{grid-template-columns: 1fr} }
  .card{
    background:linear-gradient(180deg,#151826, #121522); border:1px solid #22263a; border-radius:16px; padding:16px;
    box-shadow: 0 10px 30px rgba(0,0,0,.25);
  }
  h2{margin:0 0 14px; color:var(--accent)}
  .row{display:grid; gap:20px; grid-template-columns: repeat(2,1fr)}
  @media (max-width:800px){.row{grid-template-columns:1fr}}
  /* Dashboard */
  .kpis{display:grid; grid-template-columns: repeat(3,1fr); gap:10px; margin-top:12px}
  .kpi{background:#14182a; border:1px solid #22263a; border-radius:12px; padding:10px}
  .kpi small{color:var(--muted)}
  .kpi strong{font-size:1.2rem}
  .goal{margin-top:12px}
  progress{width:100%; height:16px; -webkit-appearance:none; appearance:none}
  progress::-webkit-progress-bar{background:#0f1324; border-radius:10px}
  progress::-webkit-progress-value{background:linear-gradient(90deg,var(--accent),#5ef3ff); border-radius:10px}
  canvas#lineChart{width:100%; height:160px; display:block; background: #0f1324; border-radius:10px}
  /* Avatar */
  #avatar-shell{display:flex; align-items:center; gap:16px}
  #avatar{
    width:160px; height:160px; border-radius:50%; background: radial-gradient(120px 120px at 50% 40%, #1f2240, #121527);
    border:2px solid #2b3157; position:relative; box-shadow: 0 10px 40px rgba(0, 224, 255, .15);
    animation: breathe 5s ease-in-out infinite;
  }
  @keyframes breathe {0%,100%{transform:scale(1)}50%{transform:scale(1.04)}}
  .eye{
    width:18px; height:18px; background:#dff6ff; border-radius:50%; position:absolute; top:54px; box-shadow:0 0 10px rgba(0,224,255,.5) inset;
  }
  .eye::after{content:''; position:absolute; width:8px; height:8px; background:#0b0f1a; border-radius:50%; left:5px; top:5px}
  .eye.left{left:48px} .eye.right{right:48px}
  .blink{animation: blink 6s infinite}
  @keyframes blink{0%,92%,100%{transform:scaleY(1)}94%{transform:scaleY(0.1)}96%{transform:scaleY(1)}}
  .mouth{
    position:absolute; left:50%; transform:translateX(-50%); bottom:42px; width:46px; height:10px; background:#0a0f1a; border-radius:0 0 24px 24px;
    border-top:2px solid #2b3157; overflow:hidden; transition: height .15s;
  }
  .mouth.speaking{height:26px; background:linear-gradient(#a83258,#6d163a)}
  .mood{display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border:1px solid #243050; border-radius:999px; background:#12162a; color:var(--muted)}
  .talk{display:flex; gap:8px; flex-wrap:wrap}
  button{
    background: linear-gradient(180deg, var(--accent), #00bbd4); color:#00141a; border:none; padding:10px 14px; border-radius:10px; font-weight:700; cursor:pointer;
    box-shadow: 0 6px 18px rgba(0,224,255,.25); transition: transform .06s ease;
  }
  button:hover{transform: translateY(-1px)}
  button.secondary{background:#1a2040; color:#cfe8ff; border:1px solid #2b3157; box-shadow:none}
  /* Mind log */
  textarea{width:100%; min-height:90px; border:none; border-radius:10px; background:#0f1426; color:#eaf6ff; padding:12px}
  .logs{max-height:200px; overflow:auto; display:grid; gap:8px; margin-top:10px}
  .log{background:#0f1426; border:1px solid #1f2744; border-radius:10px; padding:10px}
  .log small{color:var(--muted)}
  .suggestions{margin-top:8px; font-size:14px; color:var(--muted)}
  .suggestion{cursor:pointer; color:var(--accent); text-decoration:underline; margin-right:12px}
  .suggestion:hover{color:#5ef3ff}
  .suggestion.glow{box-shadow: 0 0 10px rgba(0,224,255,.5); background: rgba(0,224,255,.1); border-radius:4px; padding:2px 4px}
  #suggestionsContainer.glow-box{box-shadow: 0 0 10px rgba(0,224,255,.5), 0 0 20px rgba(0,224,255,.3), inset 0 0 10px rgba(0,224,255,.1)}
  /* Exercises */
  .exercise-grid{display:grid; gap:12px; grid-template-columns: repeat(2,1fr)}
  .exercise{background:#151b34; border:1px solid #223057; border-radius:12px; padding:12px}
  .exercise h3{margin:0 0 8px; color:#7fd3ff}
  .pill{display:inline-block; background:#11213a; border:1px solid #27436a; color:#a8d9ff; padding:4px 8px; border-radius:999px; font-size:12px}
  .motivation{background:linear-gradient(90deg,#102039,#0d1c33); border:1px solid #1e3a66; border-radius:12px; padding:12px; color:#cfe8ff}
  /* Breathing widget */
  #breath{
    margin-top:12px; width:100%; height:180px; display:flex; align-items:center; justify-content:center; position:relative; overflow:hidden;
    background: radial-gradient(200px 120px at 50% 100%, rgba(0,224,255,.06), rgba(0,0,0,0));
    border-radius:12px; border:1px solid #1a2b45;
  }
  #orb{
    width:80px; height:80px; border-radius:50%; background:radial-gradient(closest-side, rgba(0,224,255,.9), rgba(0,224,255,.2));
    box-shadow: 0 0 40px rgba(0,224,255,.4), 0 0 90px rgba(0,224,255,.2);
  }
  /* Memory game */
  #memory{display:grid; grid-template-columns: repeat(4, 1fr); gap:10px; margin-top:10px}
  .card-cell{
    aspect-ratio:1/1; background:#0f1426; border:1px dashed #2a3a63; border-radius:10px; display:flex; align-items:center; justify-content:center;
    font-size:28px; cursor:pointer; transition:transform .08s; user-select:none;
  }
  .card-cell.revealed{background:#17224a; border-style:solid}
  .card-cell.matched{background:#0d2330; border:1px solid #2d6a52; color:#7cffb2}
  .flex{display:flex; align-items:center; justify-content:space-between; gap:10px}
  .muted{color:var(--muted)}
  .sr{position:absolute; left:-10000px}
</style>
</head>
<body>
<header>
  <div style="display: flex; justify-content: space-between; align-items: center;">
    <div>
      <h1>üß† NeuroVox Recovery Companion</h1>
      <p>Emotion-aware guidance, daily progress, and engaging exercises to speed up recovery.</p>
    </div>
    <button onclick="window.location.href='index.html'" style="background: linear-gradient(180deg, var(--accent), #00bbd4); color:#00141a; border:none; padding:10px 14px; border-radius:10px; font-weight:700; cursor:pointer; box-shadow: 0 6px 18px rgba(0,224,255,.25); transition: transform .06s ease;">üè† Home</button>
  </div>
</header>

<main>
  <!-- Left column -->
  <section class="card">
    <h2>Recovery dashboard</h2>
    <canvas id="lineChart" aria-label="Daily progress chart"></canvas>
    <div class="kpis">
      <div class="kpi"><small>Focus score</small><div><strong id="kpiFocus">68</strong></div></div>
      <div class="kpi"><small>Mood trend</small><div><strong id="kpiMood">üôÇ Stable</strong></div></div>
      <div class="kpi"><small>Streak</small><div><strong id="kpiStreak">0 days</strong></div></div>
    </div>
    <div class="goal">
      <div class="flex">
        <div class="muted">üéØ Goal: Complete 3 focus sessions today</div>
        <div id="goalCount" class="muted">0/3</div>
      </div>
      <progress id="goalProgress" value="0" max="3"></progress>
    </div>
  </section>

  <!-- Right column -->
  <section class="card">
    <h2>NeuroVox companion</h2>
    <div id="avatar-shell">
      <div id="avatar" aria-label="AI avatar">
        <div class="eye left blink"></div>
        <div class="eye right blink"></div>
        <div id="mouth" class="mouth"></div>
      </div>
      <div style="flex:1">
        <div class="flex" style="gap:8px; flex-wrap:wrap">
          <span class="mood" id="moodTag">Mood: balanced</span>
          <span class="mood">Voice: calm</span>
        </div>
        <p id="botLine" class="muted" style="margin:10px 0 14px">Hi, I‚Äôm here with you. Ready for a gentle start?</p>
        <div class="talk">
          <select id="langSelect" class="secondary" style="padding:10px; border-radius:10px; background:#1a2040; color:#cfe8ff; border:1px solid #2b3157;">
            <option value="en-US">English</option>
            <option value="hi-IN">Hindi</option>
          </select>
          <button id="btnSpeak">üí¨ Talk to me</button>
          <button id="btnEncourage" class="secondary">‚ú® Encourage me</button>
          <button id="btnExercise" class="secondary">üßò Start breathing</button>
          <button id="btnStop" class="secondary">üîá Stop Talking</button>
        </div>
      </div>
    </div>
  </section>

  <!-- Mind log -->
  <section class="card">
    <h2>Mind log</h2>
    <textarea id="logInput" placeholder="How are you feeling today? Share a few words."></textarea>
    <div id="suggestionsContainer" class="suggestions" style="margin-top:8px; padding:8px; border:1px solid #1f2744; border-radius:8px; background:#0f1426;">
      <small style="color:var(--muted); display:block; margin-bottom:6px;">Need inspiration? Click a prompt to start:</small>
      <div style="display:flex; flex-wrap:wrap; gap:8px;"></div>
    </div>
    <div class="flex" style="margin-top:10px">
      <button id="saveLog">Save entry</button>
      <span class="muted">Entries are saved on your device.</span>
    </div>
    <div id="logList" class="logs" aria-live="polite"></div>
  </section>

  <!-- Exercises + motivation -->
  <section class="card">
    <h2>Exercises and motivation</h2>
    <div class="row">
      <div class="exercise">
        <h3>Guided breathing <span class="pill">Box 4-4-4</span></h3>
        <div id="breath">
          <div id="orb" aria-hidden="true"></div>
          <div class="sr" id="breathSr">Breathing guidance</div>
        </div>
        <div class="flex" style="margin-top:10px">
          <button id="startBreath">Start</button>
          <button id="stopBreath" class="secondary">Stop</button>
        </div>
      </div>
      <div class="exercise">
        <h3>Memory match <span class="pill">Cognition</span></h3>
        <div class="flex muted" style="margin-bottom:6px">
          <span>Matches: <strong id="memMatches">0</strong></span>
          <span>Moves: <strong id="memMoves">0</strong></span>
        </div>
        <div id="memory"></div>
        <div class="flex" style="margin-top:10px">
          <button id="resetMem">Reset</button>
          <span class="muted" id="memMsg"></span>
        </div>
      </div>
    </div>
    <div class="motivation" style="margin-top:14px">
      <div id="motivationText">Small steps count. Today‚Äôs effort is tomorrow‚Äôs strength.</div>
    </div>
  </section>
</main>

<footer>
  <div class="flex">
    <span class="muted">¬© 2025 NeuroVox ‚Äî Designed for recovery and support</span>
    <span class="muted">Dark mode ‚Ä¢ Smooth animations ‚Ä¢ Accessible</span>
  </div>
</footer>

<script>
/* ---------- Storage helpers ---------- */
const store = {
  get: (k, def) => { try{ const v = JSON.parse(localStorage.getItem(k)); return v ?? def } catch { return def } },
  set: (k, v) => localStorage.setItem(k, JSON.stringify(v))
};

/* ---------- Language texts ---------- */
const texts = {
  en: {
    speakLines: ["Hello. I‚Äôm right here with you. Shall we take a gentle breath together?", "Your effort is visible. One focused minute at a time is enough.", "Tell me how today feels. I‚Äôm listening."],
    encourage: "I notice your consistency. That‚Äôs powerful. Let‚Äôs log a thought and do one calming breath.",
    breathing: "Let‚Äôs do box breathing. Inhale four, hold four, exhale four. Ready?",
    inhale: "Inhale... 2... 3... 4",
    hold: "Hold... 2... 3... 4",
    exhale: "Exhale... 2... 3... 4",
    rest: "Rest...",
    memoryMatch: "Nice match. Keep going!",
    breathingStopped: "Breathing stopped.",
    brainWarmedUp: "Great job! Brain warmed up.",
    greeting: "Welcome back. Let‚Äôs make one small, kind step for your recovery.",
    logResponse: {
      negative: "Thank you for sharing that. Let‚Äôs slow everything down with one minute of gentle breathing.",
      positive: "I feel that lift. Beautiful. Let‚Äôs capture this momentum with a quick focus round.",
      neutral: "Got it. I‚Äôm with you. One steady step at a time."
    }
  },
  hi: {
    speakLines: ["‡§®‡§Æ‡§∏‡•ç‡§§‡•á‡•§ ‡§Æ‡•à‡§Ç ‡§Ü‡§™ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§π‡•Ç‡§Å‡•§ ‡§ï‡•ç‡§Ø‡§æ ‡§π‡§Æ ‡§∏‡§æ‡§• ‡§Æ‡•á‡§Ç ‡§è‡§ï ‡§∏‡•å‡§Æ‡•ç‡§Ø ‡§∏‡§æ‡§Å‡§∏ ‡§≤‡•á‡§Ç?", "‡§Ü‡§™‡§ï‡§æ ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§¶‡§ø‡§ñ‡§æ‡§à ‡§¶‡•á ‡§∞‡§π‡§æ ‡§π‡•à‡•§ ‡§è‡§ï ‡§ï‡•á‡§Ç‡§¶‡•ç‡§∞‡§ø‡§§ ‡§Æ‡§ø‡§®‡§ü ‡§ï‡§æ‡§´‡•Ä ‡§π‡•à‡•§", "‡§Ü‡§ú ‡§ï‡•à‡§∏‡§æ ‡§≤‡§ó ‡§∞‡§π‡§æ ‡§π‡•à ‡§¨‡§§‡§æ‡§è‡§Ç‡•§ ‡§Æ‡•à‡§Ç ‡§∏‡•Å‡§® ‡§∞‡§π‡§æ ‡§π‡•Ç‡§Å‡•§"],
    encourage: "‡§Æ‡•à‡§Ç ‡§Ü‡§™‡§ï‡•Ä ‡§®‡§ø‡§∞‡§Ç‡§§‡§∞‡§§‡§æ ‡§ï‡•ã ‡§®‡•ã‡§ü‡§ø‡§∏ ‡§ï‡§∞‡§§‡§æ ‡§π‡•Ç‡§Å‡•§ ‡§Ø‡§π ‡§∂‡§ï‡•ç‡§§‡§ø‡§∂‡§æ‡§≤‡•Ä ‡§π‡•à‡•§ ‡§ö‡§≤‡§ø‡§è ‡§è‡§ï ‡§µ‡§ø‡§ö‡§æ‡§∞ ‡§≤‡•â‡§ó ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç ‡§î‡§∞ ‡§è‡§ï ‡§∂‡§æ‡§Ç‡§§ ‡§∏‡§æ‡§Å‡§∏ ‡§≤‡•á‡§§‡•á ‡§π‡•à‡§Ç‡•§",
    breathing: "‡§ö‡§≤‡•ã ‡§¨‡•â‡§ï‡•ç‡§∏ ‡§¨‡•ç‡§∞‡•á‡§•‡§ø‡§Ç‡§ó ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç‡•§ ‡§ö‡§æ‡§∞ ‡§Æ‡•á‡§Ç ‡§∏‡§æ‡§Å‡§∏ ‡§≤‡•á‡§Ç, ‡§ö‡§æ‡§∞ ‡§Æ‡•á‡§Ç ‡§∞‡•ã‡§ï‡•á‡§Ç, ‡§ö‡§æ‡§∞ ‡§Æ‡•á‡§Ç ‡§õ‡•ã‡§°‡§º‡•á‡§Ç‡•§ ‡§§‡•à‡§Ø‡§æ‡§∞?",
    inhale: "‡§∏‡§æ‡§Å‡§∏ ‡§≤‡•á‡§Ç... 2... 3... 4",
    hold: "‡§∞‡•ã‡§ï‡•á‡§Ç... 2... 3... 4",
    exhale: "‡§õ‡•ã‡§°‡§º‡•á‡§Ç... 2... 3... 4",
    rest: "‡§µ‡§ø‡§∂‡•ç‡§∞‡§æ‡§Æ...",
    memoryMatch: "‡§Ö‡§ö‡•ç‡§õ‡§æ ‡§Æ‡•à‡§ö‡•§ ‡§ú‡§æ‡§∞‡•Ä ‡§∞‡§ñ‡•á‡§Ç!",
    breathingStopped: "‡§∏‡§æ‡§Å‡§∏ ‡§≤‡•á‡§®‡§æ ‡§∞‡•Å‡§ï ‡§ó‡§Ø‡§æ‡•§",
    brainWarmedUp: "‡§¨‡§π‡•Å‡§§ ‡§¨‡§¢‡§º‡§ø‡§Ø‡§æ! ‡§¶‡§ø‡§Æ‡§æ‡§ó ‡§ó‡§∞‡•ç‡§Æ ‡§π‡•ã ‡§ó‡§Ø‡§æ‡•§",
    greeting: "‡§µ‡§æ‡§™‡§∏‡•Ä ‡§™‡§∞ ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à‡•§ ‡§ö‡§≤‡§ø‡§è ‡§Ö‡§™‡§®‡•Ä ‡§∞‡§ø‡§ï‡§µ‡§∞‡•Ä ‡§ï‡•á ‡§≤‡§ø‡§è ‡§è‡§ï ‡§õ‡•ã‡§ü‡§æ ‡§∏‡§æ ‡§ï‡§¶‡§Æ ‡§â‡§†‡§æ‡§§‡•á ‡§π‡•à‡§Ç‡•§",
    logResponse: {
      negative: "‡§á‡§∏‡§ï‡§æ ‡§∏‡§æ‡§ù‡§æ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶‡•§ ‡§ö‡§≤‡§ø‡§è ‡§∏‡§¨ ‡§ï‡•Å‡§õ ‡§ß‡•Ä‡§Æ‡§æ ‡§ï‡§∞ ‡§¶‡•á‡§Ç ‡§î‡§∞ ‡§è‡§ï ‡§Æ‡§ø‡§®‡§ü ‡§ï‡•Ä ‡§∂‡§æ‡§Ç‡§§ ‡§∏‡§æ‡§Å‡§∏ ‡§≤‡•á‡§Ç‡•§",
      positive: "‡§Æ‡•à‡§Ç ‡§Ø‡§π ‡§â‡§†‡§æ‡§µ ‡§Æ‡§π‡§∏‡•Ç‡§∏ ‡§ï‡§∞‡§§‡§æ ‡§π‡•Ç‡§Å‡•§ ‡§∏‡•Å‡§Ç‡§¶‡§∞‡•§ ‡§ö‡§≤‡§ø‡§è ‡§á‡§∏ ‡§ó‡§§‡§ø ‡§ï‡•ã ‡§è‡§ï ‡§§‡•ç‡§µ‡§∞‡§ø‡§§ ‡§´‡•ã‡§ï‡§∏ ‡§¶‡•å‡§∞ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§¨‡§®‡§æ‡§è ‡§∞‡§ñ‡•á‡§Ç‡•§",
      neutral: "‡§∏‡§Æ‡§ù ‡§ó‡§Ø‡§æ‡•§ ‡§Æ‡•à‡§Ç ‡§Ü‡§™‡§ï‡•á ‡§∏‡§æ‡§• ‡§π‡•Ç‡§Å‡•§ ‡§è‡§ï ‡§∏‡§Æ‡§Ø ‡§Æ‡•á‡§Ç ‡§è‡§ï ‡§∏‡•ç‡§•‡§ø‡§∞ ‡§ï‡§¶‡§Æ‡•§"
    }
  },
  mr: {
    speakLines: ["‡§®‡§Æ‡§∏‡•ç‡§ï‡§æ‡§∞‡•§ ‡§Æ‡•Ä ‡§§‡•Å‡§Æ‡§ö‡•ç‡§Ø‡§æ‡§¨‡§∞‡•ã‡§¨‡§∞ ‡§Ü‡§π‡•á. ‡§Ü‡§™‡§£ ‡§è‡§ï‡§§‡•ç‡§∞ ‡§è‡§ï ‡§∏‡•å‡§Æ‡•ç‡§Ø ‡§∂‡•ç‡§µ‡§æ‡§∏ ‡§ò‡•á‡§ä‡§Ø‡§æ ‡§ï‡§æ?", "‡§§‡•Å‡§Æ‡§ö‡§æ ‡§™‡•ç‡§∞‡§Ø‡§§‡•ç‡§® ‡§¶‡§ø‡§∏‡§§ ‡§Ü‡§π‡•á. ‡§è‡§ï ‡§ï‡•á‡§Ç‡§¶‡•ç‡§∞‡§ø‡§§ ‡§Æ‡§ø‡§®‡§ø‡§ü ‡§™‡•Å‡§∞‡•á‡§∏‡•á ‡§Ü‡§π‡•á.", "‡§Ü‡§ú ‡§ï‡§∏‡•á ‡§µ‡§æ‡§ü‡§§‡•á ‡§§‡•á ‡§∏‡§æ‡§Ç‡§ó‡§æ. ‡§Æ‡•Ä ‡§ê‡§ï‡§§ ‡§Ü‡§π‡•á."],
    encourage: "‡§Æ‡•Ä ‡§§‡•Å‡§Æ‡§ö‡•Ä ‡§∏‡§æ‡§§‡§§‡•ç‡§Ø ‡§®‡•ã‡§Ç‡§¶‡§µ‡§§‡•ã. ‡§π‡•á ‡§∂‡§ï‡•ç‡§§‡§ø‡§∂‡§æ‡§≤‡•Ä ‡§Ü‡§π‡•á. ‡§ö‡§≤‡•ã ‡§è‡§ï ‡§µ‡§ø‡§ö‡§æ‡§∞ ‡§≤‡•â‡§ó ‡§ï‡§∞‡•Ç‡§Ø‡§æ ‡§Ü‡§£‡§ø ‡§è‡§ï ‡§∂‡§æ‡§Ç‡§§ ‡§∂‡•ç‡§µ‡§æ‡§∏ ‡§ò‡•á‡§ä‡§Ø‡§æ.",
    breathing: "‡§ö‡§≤‡•ã ‡§¨‡•â‡§ï‡•ç‡§∏ ‡§¨‡•ç‡§∞‡•á‡§•‡§ø‡§Ç‡§ó ‡§ï‡§∞‡•Ç‡§Ø‡§æ. ‡§ö‡§æ‡§∞‡§Æ‡§ß‡•ç‡§Ø‡•á ‡§∂‡•ç‡§µ‡§æ‡§∏ ‡§ò‡•ç‡§Ø‡§æ, ‡§ö‡§æ‡§∞‡§Æ‡§ß‡•ç‡§Ø‡•á ‡§ß‡§∞‡§æ, ‡§ö‡§æ‡§∞‡§Æ‡§ß‡•ç‡§Ø‡•á ‡§∏‡•ã‡§°‡§æ. ‡§§‡§Ø‡§æ‡§∞?",
    inhale: "‡§∂‡•ç‡§µ‡§æ‡§∏ ‡§ò‡•ç‡§Ø‡§æ... 2... 3... 4",
    hold: "‡§ß‡§∞‡§æ... 2... 3... 4",
    exhale: "‡§∏‡•ã‡§°‡§æ... 2... 3... 4",
    rest: "‡§µ‡§ø‡§∂‡•ç‡§∞‡§æ‡§Ç‡§§‡•Ä...",
    memoryMatch: "‡§õ‡§æ‡§® ‡§ú‡•Å‡§≥‡§£‡•Ä‡•§ ‡§ö‡§æ‡§≤‡•Ç ‡§†‡•á‡§µ‡§æ!",
    breathingStopped: "‡§∂‡•ç‡§µ‡§æ‡§∏ ‡§ò‡•á‡§£‡•á ‡§•‡§æ‡§Ç‡§¨‡§≤‡•á.",
    brainWarmedUp: "‡§õ‡§æ‡§® ‡§ï‡§æ‡§Æ! ‡§Æ‡•á‡§Ç‡§¶‡•Ç ‡§ó‡§∞‡§Æ ‡§ù‡§æ‡§≤‡§æ.",
    greeting: "‡§™‡§∞‡§§ ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§Ü‡§π‡•á. ‡§ö‡§≤‡•ã ‡§Ü‡§™‡§≤‡•ç‡§Ø‡§æ ‡§∞‡§ø‡§ï‡§µ‡•ç‡§π‡§∞‡•Ä‡§∏‡§æ‡§†‡•Ä ‡§è‡§ï ‡§õ‡•ã‡§ü‡§æ‡§∏‡§æ ‡§™‡§æ‡§ä‡§≤ ‡§â‡§ö‡§≤‡•Ç‡§Ø‡§æ.",
    logResponse: {
      negative: "‡§π‡•á ‡§∏‡§æ‡§Æ‡§æ‡§Ø‡§ø‡§ï ‡§ï‡•á‡§≤‡•ç‡§Ø‡§æ‡§¨‡§¶‡•ç‡§¶‡§≤ ‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶. ‡§ö‡§≤‡•ã ‡§∏‡§∞‡•ç‡§µ‡§ï‡§æ‡§π‡•Ä ‡§π‡§≥‡•Ç ‡§ï‡§∞‡•Ç‡§Ø‡§æ ‡§Ü‡§£‡§ø ‡§è‡§ï ‡§Æ‡§ø‡§®‡§ø‡§ü ‡§∂‡§æ‡§Ç‡§§ ‡§∂‡•ç‡§µ‡§æ‡§∏ ‡§ò‡•á‡§ä‡§Ø‡§æ.",
      positive: "‡§Æ‡•Ä ‡§π‡§æ ‡§â‡§Ç‡§ö‡§µ‡§ü‡§æ ‡§ú‡§æ‡§£‡§µ‡§§‡•ã. ‡§∏‡•Å‡§Ç‡§¶‡§∞. ‡§ö‡§≤‡•ã ‡§π‡•Ä ‡§ó‡§§‡•Ä ‡§è‡§ï ‡§ú‡§≤‡§¶ ‡§´‡•ã‡§ï‡§∏ ‡§¶‡•å‡§∞‡§æ‡§®‡•á ‡§∞‡§æ‡§ñ‡•Ç‡§Ø‡§æ.",
      neutral: "‡§∏‡§Æ‡§ú‡§≤‡•á. ‡§Æ‡•Ä ‡§§‡•Å‡§Æ‡§ö‡•ç‡§Ø‡§æ‡§¨‡§∞‡•ã‡§¨‡§∞ ‡§Ü‡§π‡•á. ‡§è‡§ï‡§æ ‡§µ‡•á‡§≥‡•Ä ‡§è‡§ï ‡§∏‡•ç‡§•‡§ø‡§∞ ‡§™‡§æ‡§ä‡§≤."
    }
  },
  bn: {
    speakLines: ["‡¶®‡¶Æ‡¶∏‡ßç‡¶ï‡¶æ‡¶∞‡•§ ‡¶Ü‡¶Æ‡¶ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶Ü‡¶õ‡¶ø‡•§ ‡¶Ü‡¶Æ‡¶∞‡¶æ ‡¶è‡¶ï‡¶∏‡¶æ‡¶•‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶∏‡ßÅ‡¶Æ‡¶ß‡ßÅ‡¶∞ ‡¶∂‡ßç‡¶¨‡¶æ‡¶∏ ‡¶®‡ßá‡¶¨ ‡¶ï‡¶ø?", "‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶¶‡ßÉ‡¶∂‡ßç‡¶Ø‡¶Æ‡¶æ‡¶®‡•§ ‡¶è‡¶ï‡¶ü‡¶ø ‡¶´‡ßã‡¶ï‡¶æ‡¶∏‡¶° ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü ‡¶Ø‡¶•‡ßá‡¶∑‡ßç‡¶ü‡•§", "‡¶Ü‡¶ú ‡¶ï‡ßá‡¶Æ‡¶® ‡¶≤‡¶æ‡¶ó‡¶õ‡ßá ‡¶¨‡¶≤‡ßÅ‡¶®‡•§ ‡¶Ü‡¶Æ‡¶ø ‡¶∂‡ßÅ‡¶®‡¶õ‡¶ø‡•§"],
    encourage: "‡¶Ü‡¶Æ‡¶ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ß‡¶æ‡¶∞‡¶æ‡¶¨‡¶æ‡¶π‡¶ø‡¶ï‡¶§‡¶æ ‡¶≤‡¶ï‡ßç‡¶∑‡ßç‡¶Ø ‡¶ï‡¶∞‡¶ø‡•§ ‡¶è‡¶ü‡¶ø ‡¶∂‡¶ï‡ßç‡¶§‡¶ø‡¶∂‡¶æ‡¶≤‡ßÄ‡•§ ‡¶ö‡¶≤‡ßÅ‡¶® ‡¶è‡¶ï‡¶ü‡¶ø ‡¶ö‡¶ø‡¶®‡ßç‡¶§‡¶æ ‡¶≤‡¶ó ‡¶ï‡¶∞‡¶ø ‡¶è‡¶¨‡¶Ç ‡¶è‡¶ï‡¶ü‡¶ø ‡¶∂‡¶æ‡¶®‡ßç‡¶§ ‡¶∂‡ßç‡¶¨‡¶æ‡¶∏ ‡¶®‡¶ø‡¶á‡•§",
    breathing: "‡¶ö‡¶≤‡ßÅ‡¶® ‡¶¨‡¶ï‡ßç‡¶∏ ‡¶¨‡ßç‡¶∞‡¶ø‡¶¶‡¶ø‡¶Ç ‡¶ï‡¶∞‡¶ø‡•§ ‡¶ö‡¶æ‡¶∞‡ßá ‡¶∂‡ßç‡¶¨‡¶æ‡¶∏ ‡¶®‡¶ø‡¶®, ‡¶ö‡¶æ‡¶∞‡ßá ‡¶ß‡¶∞‡ßÅ‡¶®, ‡¶ö‡¶æ‡¶∞‡ßá ‡¶õ‡¶æ‡¶°‡¶º‡ßÅ‡¶®‡•§ ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡ßÅ‡¶§?",
    inhale: "‡¶∂‡ßç‡¶¨‡¶æ‡¶∏ ‡¶®‡¶ø‡¶®... 2... 3... 4",
    hold: "‡¶ß‡¶∞‡ßÅ‡¶®... 2... 3... 4",
    exhale: "‡¶õ‡¶æ‡¶°‡¶º‡ßÅ‡¶®... 2... 3... 4",
    rest: "‡¶¨‡¶ø‡¶∂‡ßç‡¶∞‡¶æ‡¶Æ...",
    memoryMatch: "‡¶≠‡¶æ‡¶≤‡ßã ‡¶Æ‡¶ø‡¶≤‡•§ ‡¶ö‡¶æ‡¶≤‡¶ø‡¶Ø‡¶º‡ßá ‡¶Ø‡¶æ‡¶®!",
    breathingStopped: "‡¶∂‡ßç‡¶¨‡¶æ‡¶∏ ‡¶®‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶¨‡¶®‡ßç‡¶ß ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§",
    brainWarmedUp: "‡¶ö‡¶Æ‡ßé‡¶ï‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶ú! ‡¶Æ‡¶∏‡ßç‡¶§‡¶ø‡¶∑‡ßç‡¶ï ‡¶ó‡¶∞‡¶Æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§",
    greeting: "‡¶´‡¶ø‡¶∞‡ßá ‡¶Ü‡¶∏‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ‡•§ ‡¶ö‡¶≤‡ßÅ‡¶® ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶™‡ßÅ‡¶®‡¶∞‡ßÅ‡¶¶‡ßç‡¶ß‡¶æ‡¶∞‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶è‡¶ï‡¶ü‡¶ø ‡¶õ‡ßã‡¶ü ‡¶™‡¶¶‡¶ï‡ßç‡¶∑‡ßá‡¶™ ‡¶®‡¶ø‡¶á‡•§",
    logResponse: {
      negative: "‡¶è‡¶ü‡¶ø ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ß‡¶®‡ßç‡¶Ø‡¶¨‡¶æ‡¶¶‡•§ ‡¶ö‡¶≤‡ßÅ‡¶® ‡¶∏‡¶¨‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶ß‡ßÄ‡¶∞ ‡¶ï‡¶∞‡¶ø ‡¶è‡¶¨‡¶Ç ‡¶è‡¶ï ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü ‡¶∂‡¶æ‡¶®‡ßç‡¶§ ‡¶∂‡ßç‡¶¨‡¶æ‡¶∏ ‡¶®‡¶ø‡¶á‡•§",
      positive: "‡¶Ü‡¶Æ‡¶ø ‡¶è‡¶á ‡¶â‡¶§‡ßç‡¶•‡¶æ‡¶® ‡¶Ö‡¶®‡ßÅ‡¶≠‡¶¨ ‡¶ï‡¶∞‡¶ø‡•§ ‡¶∏‡ßÅ‡¶®‡ßç‡¶¶‡¶∞‡•§ ‡¶ö‡¶≤‡ßÅ‡¶® ‡¶è‡¶á ‡¶ó‡¶§‡¶ø ‡¶è‡¶ï‡¶ü‡¶ø ‡¶¶‡ßç‡¶∞‡ßÅ‡¶§ ‡¶´‡ßã‡¶ï‡¶æ‡¶∏ ‡¶∞‡¶æ‡¶â‡¶®‡ßç‡¶° ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶ß‡¶∞‡ßá ‡¶∞‡¶æ‡¶ñ‡¶ø‡•§",
      neutral: "‡¶¨‡ßÅ‡¶ù‡ßá‡¶õ‡¶ø‡•§ ‡¶Ü‡¶Æ‡¶ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶Ü‡¶õ‡¶ø‡•§ ‡¶è‡¶ï‡¶¨‡¶æ‡¶∞‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶∏‡ßç‡¶•‡¶ø‡¶∞ ‡¶™‡¶¶‡¶ï‡ßç‡¶∑‡ßá‡¶™‡•§"
    }
  }
};

let selectedLang = 'en-US';
function getLangKey(lang) { return lang.split('-')[0]; }

/* ---------- Motivational rotation ---------- */
const MOTIVATIONS = [
  "Small steps count. Today‚Äôs effort is tomorrow‚Äôs strength.",
  "Breathe. Reset. You are doing better than you think.",
  "Recovery isn‚Äôt linear. We celebrate consistency, not perfection.",
  "Your brain learns from gentle repetition. Let‚Äôs keep it kind.",
  "You showed up. That matters more than anything."
];
(function cycleMotivation(){
  const el = document.getElementById('motivationText');
  let i = 0;
  setInterval(()=>{ i=(i+1)%MOTIVATIONS.length; el.textContent = MOTIVATIONS[i]; }, 8000);
})();

/* ---------- Simple sparkline/line chart ---------- */
const chartEl = document.getElementById('lineChart');
const ctx = chartEl.getContext('2d');
let series = store.get('nv_series', []);
if(series.length === 0){ series = Array.from({length:10},(_,i)=> 50 + Math.round(Math.sin(i/2)*15)+ Math.round(Math.random()*8)); store.set('nv_series', series) }
function drawChart(){
  const w = chartEl.clientWidth, h = chartEl.clientHeight;
  chartEl.width = w*2; chartEl.height = h*2; ctx.scale(2,2);
  ctx.clearRect(0,0,w,h);
  // grid with labels
  ctx.strokeStyle = '#1c2543'; ctx.lineWidth = 1; ctx.fillStyle = '#a3b3c2'; ctx.font = '12px Inter, sans-serif';
  const gridLines = 5;
  for(let y=0;y<=gridLines;y++){
    const yy = h - (y*h/gridLines);
    ctx.beginPath(); ctx.moveTo(0,yy); ctx.lineTo(w,yy); ctx.stroke();
    const label = (y * 100 / gridLines).toFixed(0);
    ctx.fillText(label, 4, yy - 4);
  }
  // smooth line using bezier curves
  const max = 100, min = 0;
  ctx.beginPath(); ctx.lineWidth = 2; ctx.strokeStyle = '#00e0ff';
  function getPoint(i){
    const x = (i/(series.length-1))*w;
    const y = h - ((series[i]-min)/(max-min))*h;
    return {x,y};
  }
  let p0 = getPoint(0);
  ctx.moveTo(p0.x, p0.y);
  for(let i=1; i<series.length; i++){
    const p1 = getPoint(i);
    const cpX = (p0.x + p1.x) / 2;
    ctx.bezierCurveTo(cpX, p0.y, cpX, p1.y, p1.x, p1.y);
    p0 = p1;
  }
  ctx.stroke();
  // fill with gradient
  const grad = ctx.createLinearGradient(0,0,0,h);
  grad.addColorStop(0, 'rgba(0,224,255,.3)'); grad.addColorStop(1, 'rgba(0,224,255,0)');
  ctx.lineTo(w,h); ctx.lineTo(0,h); ctx.closePath(); ctx.fillStyle = grad; ctx.fill();
}
drawChart();

/* ---------- KPI, streak, goals ---------- */
const todayKey = 'nv_last_open';
const lastOpen = store.get(todayKey, null);
const today = new Date().toDateString();
let streak = store.get('nv_streak', 0);
if(lastOpen && new Date(lastOpen).toDateString() !== today){
  const diff = (new Date(today) - new Date(lastOpen)) / (1000*60*60*24);
  if(diff <= 2){ streak = streak + 1 } else { streak = 1 }
} else if(!lastOpen){ streak = 1 }
store.set('nv_streak', streak); store.set(todayKey, new Date().toString());
document.getElementById('kpiStreak').textContent = `${streak} day${streak>1?'s':''}`;

let goalCount = store.get('nv_goal', 0);
const goalProgress = document.getElementById('goalProgress');
const goalCountEl = document.getElementById('goalCount');
function setGoal(v){ goalCount = Math.min(3, Math.max(0, v)); store.set('nv_goal', goalCount); goalProgress.value = goalCount; goalCountEl.textContent = `${goalCount}/3`; }
setGoal(goalCount);

/* ---------- Avatar speech & emotion ---------- */
const mouth = document.getElementById('mouth');
const botLine = document.getElementById('botLine');
const moodTag = document.getElementById('moodTag');

function speak(text, {rate=1, pitch=1.05, lang='en-US'} = {}){
  const u = new SpeechSynthesisUtterance(text);
  u.rate = rate; u.pitch = pitch; u.lang = lang;
  // basic lip-sync
  u.onstart = ()=> mouth.classList.add('speaking');
  u.onend = ()=> mouth.classList.remove('speaking');
  u.onboundary = (e)=> { if(e.name === 'word'){ mouth.classList.toggle('speaking') } };
  speechSynthesis.cancel(); speechSynthesis.speak(u);
}

document.getElementById('langSelect').addEventListener('change', (e) => {
  selectedLang = e.target.value;
});

document.getElementById('btnSpeak').addEventListener('click', ()=>{
  const text = texts[getLangKey(selectedLang)].speakLines[Math.floor(Math.random()*3)];
  botLine.textContent = text; speak(text, {lang: selectedLang});
});

document.getElementById('btnEncourage').addEventListener('click', ()=>{
  const text = texts[getLangKey(selectedLang)].encourage;
  botLine.textContent = text; speak(text, {rate:0.95, pitch:1, lang: selectedLang});
});

document.getElementById('btnStop').addEventListener('click', () => { speechSynthesis.cancel(); mouth.classList.remove('speaking'); });

/* ---------- Mind log with sentiment & KPIs ---------- */
const logInput = document.getElementById('logInput');
const logList = document.getElementById('logList');
let logs = store.get('nv_logs', []);
const suggestions = [
  "How was your day?",
  "What made you smile today?",
  "Describe a challenge you overcame.",
  "How are you feeling right now?",
  "What are you grateful for?"
];
function renderLogs(){
  logList.innerHTML = '';
  logs.slice().reverse().forEach(item=>{
    const div = document.createElement('div'); div.className='log';
    const top = document.createElement('div'); top.textContent = item.text;
    const meta = document.createElement('small'); meta.textContent = new Date(item.time).toLocaleString() + ' ‚Ä¢ Mood: ' + item.mood;
    div.appendChild(top); div.appendChild(meta);
    logList.appendChild(div);
  });
  renderSuggestions();
}
function renderSuggestions(){
  const container = document.getElementById('suggestionsContainer');
  const innerDiv = container.querySelector('div');
  innerDiv.innerHTML = '';
  suggestions.forEach(text => {
    const span = document.createElement('span');
    span.className = 'suggestion';
    span.textContent = text;
    span.addEventListener('click', () => {
      logInput.value = text;
      logInput.focus();
      span.classList.add('glow');
      container.classList.add('glow-box');
      setTimeout(() => {
        span.classList.remove('glow');
        container.classList.remove('glow-box');
      }, 500);
    });
    innerDiv.appendChild(span);
  });
}
function quickSentiment(text){
  const t = text.toLowerCase();
  const pos = ["good","okay","calm","hope","better","improve","love","grateful","proud"];
  const neg = ["bad","tired","pain","anxious","sad","worse","angry","fear","hurt","stress"];
  let s=0; pos.forEach(w=>{ if(t.includes(w)) s++ }); neg.forEach(w=>{ if(t.includes(w)) s-- });
  return s>0?"positive": s<0?"negative":"neutral";
}
renderLogs();

document.getElementById('saveLog').addEventListener('click', ()=>{
  const text = logInput.value.trim(); if(!text) return;
  const mood = quickSentiment(text);
  logs.push({text, mood, time: Date.now()});
  store.set('nv_logs', logs); renderLogs(); logInput.value='';
  // update avatar mood + kpi + chart + goal
  moodTag.textContent = 'Mood: ' + (mood==='positive'?'uplifted': mood==='negative'?'heavy':'balanced');
  document.getElementById('kpiMood').textContent = (mood==='positive'?'üòä Up': mood==='negative'?'üòî Down':'üôÇ Stable');
  // focus score nudge
  let focus = Math.min(95, Math.max(40, (series.at(-1) ?? 60) + (mood==='positive'?+3: mood==='negative'?-2: +1)));
  series.push(focus); if(series.length>20) series.shift(); store.set('nv_series', series); drawChart();
  document.getElementById('kpiFocus').textContent = focus;
  setGoal(goalCount+1);
  const response = texts[getLangKey(selectedLang)].logResponse[mood];
  botLine.textContent = response; speak(response, {rate:0.95, lang: selectedLang});

});

/* ---------- Breathing guidance (Box 4-4-4) ---------- */
const orb = document.getElementById('orb');
let breathTimer = null; let phase = 0;
function setOrb(scale, text){
  orb.style.transform = `scale(${scale})`;
  const sr = document.getElementById('breathSr'); sr.textContent = text;
}
function startBreathing(){
  clearInterval(breathTimer);
  phase = 0;
  speak(texts[getLangKey(selectedLang)].breathing, {lang: selectedLang});
  const steps = [
    {dur:4000, text:texts[getLangKey(selectedLang)].inhale, scale:[1,1.25]},
    {dur:4000, text:texts[getLangKey(selectedLang)].hold, scale:[1.25,1.25]},
    {dur:4000, text:texts[getLangKey(selectedLang)].exhale, scale:[1.25,0.95]},
    {dur:4000, text:texts[getLangKey(selectedLang)].rest, scale:[0.95,0.95]}
  ];
  const tick = ()=>{
    const s = steps[phase%steps.length];
    let start = performance.now();
    const animate = (t)=>{
      const p = Math.min(1, (t-start)/s.dur);
      const scale = s.scale[0] + (s.scale[1]-s.scale[0])*p;
      setOrb(scale, s.text);
      if(p<1){ requestAnimationFrame(animate) } else { phase++; speak(s.text, {rate:0.85, lang: selectedLang}); }
    };
    requestAnimationFrame(animate);
  };
  tick();
  breathTimer = setInterval(tick, 4000);
}
function stopBreathing(){ clearInterval(breathTimer); setOrb(1, texts[getLangKey(selectedLang)].breathingStopped); }
document.getElementById('startBreath').addEventListener('click', startBreathing);
document.getElementById('stopBreath').addEventListener('click', stopBreathing);
document.getElementById('btnExercise').addEventListener('click', startBreathing);

/* ---------- Memory game ---------- */
const EMOJIS = ["üçé","üçã","üçá","üçâ","üçì","ü•ë","üçí","üçä"];
let board = []; let first=null, second=null, lock=false, matches=0, moves=0;
const memGrid = document.getElementById('memory');
const memMatches = document.getElementById('memMatches');
const memMoves = document.getElementById('memMoves');
const memMsg = document.getElementById('memMsg');
function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]] } return a }
function initBoard(){
  matches=0; moves=0; first=second=null; lock=false; memMsg.textContent='';
  memMatches.textContent=matches; memMoves.textContent=moves;
  const cells = shuffle([...EMOJIS, ...EMOJIS]).slice(0,16);
  board = cells.map((v,i)=>({id:i, v, revealed:false, matched:false}));
  renderBoard();
}
function renderBoard(){
  memGrid.innerHTML='';
  board.forEach(cell=>{
    const d = document.createElement('div'); d.className='card-cell' + (cell.revealed?' revealed':'') + (cell.matched?' matched':'');
    d.setAttribute('data-id', cell.id);
    d.textContent = (cell.revealed || cell.matched) ? cell.v : '‚ùì';
    d.addEventListener('click', ()=> flip(cell.id));
    memGrid.appendChild(d);
  });
}
function flip(id){
  if(lock) return;
  const c = board.find(x=>x.id===id);
  if(c.matched || c.revealed) return;
  c.revealed = true; renderBoard();
  if(!first){ first = c; return }
  second = c; lock = true; moves++; memMoves.textContent = moves;
  setTimeout(()=>{
    if(first.v === second.v){
      first.matched = second.matched = true; matches++; memMatches.textContent = matches;
      speak(texts[getLangKey(selectedLang)].memoryMatch, {rate:1.02, pitch:1.08, lang: selectedLang});
      if(matches === 8){ memMsg.textContent = texts[getLangKey(selectedLang)].brainWarmedUp; setGoal(goalCount+1) }
    } else {
      first.revealed = second.revealed = false;
    }
    first = second = null; lock=false; renderBoard();
  }, 700);
}
document.getElementById('resetMem').addEventListener('click', initBoard);
initBoard();

/* ---------- Bonus: quick focus timer to bump goals ---------- */
let sessions = 0;
function quickFocus(){
  sessions++; setGoal(goalCount+1);
  const last = series.at(-1) ?? 60;
  const bumped = Math.min(100, last + 2 + Math.round(Math.random()*3));
  series.push(bumped); if(series.length>20) series.shift(); store.set('nv_series', series); drawChart();
  document.getElementById('kpiFocus').textContent = bumped;
}

/* ---------- Page-ready greeting ---------- */
window.addEventListener('load', ()=>{
  const greet = texts[getLangKey(selectedLang)].greeting;
  botLine.textContent = greet; setTimeout(()=> speak(greet, {rate:0.95, lang: selectedLang}), 400);
});
</script>
</body>
</html>
